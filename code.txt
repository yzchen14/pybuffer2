Sub test()


fNameAndPath = "D:\001.png"
If fNameAndPath = False Then Exit Sub
    Set img = Sheets("Ta").Pictures.Insert(fNameAndPath)
    img.Name = "001"
    With img
       'Resize Picture to fit in the range....
       .Left = ActiveSheet.Range("B2").Left
       .Top = ActiveSheet.Range("B2").Top
       .Width = ActiveSheet.Range("B2:B2").Width
       .Height = ActiveSheet.Range("D9:D28").Height
       .Placement = 1
       .PrintObject = True
    End With
End Sub

Sub test2()
For Each s In ActiveSheet.Shapes
Debug.Print s.Name
Debug.Print s.Type
Debug.Print s.TopLeftCell.Address(ReferenceStyle:=xlR1C1)
If s.TopLeftCell.Address(ReferenceStyle:=xlR1C1) = "R4C3" Then
Debug.Print "Found"
End If

Debug.Print "----------"

Next s
End Sub

Sub test3()
Call MkDir("df", "D:\")
End Sub


Function MkDir(path As String)

Dim fso As New FileSystemObject

If Not fso.FolderExists(path) Then
          fso.CreateFolder path
End If
End Function



Sub saveFig()

Defect_num = Sheets("TA").Cells(1, 2).Value
Mask_Name = "TMND98-7V0A-2"
defect_d = Format(Sheets("TA").Cells(1, 4).Value, "yyyymmdd")

'create folder

path = "D:\" & defect_d & "_" & Mask_Name
Call MkDir("D:\" & defect_d & "_" & Mask_Name)




For i = 1 To Defect_num
map_pos = "R4" & "C" & (i + 1)
defect_pos = "R3" & "C" & (i + 1)

    For Each s In Sheets("TA").Shapes
        
        If s.TopLeftCell.Address(ReferenceStyle:=xlR1C1) = map_pos And Not InStr(s.Name, "CC") = 1 Then
        Debug.Print s.Name
            Set shpGroup = Sheets("TA").Shapes.Range(Array(s.Name, "CC" & i)).Group
            With ActiveSheet.ChartObjects.Add(s.Left, s.Top, s.Width, s.Height)
                .Name = "buffer"
                .Activate
            End With
            shpGroup.Copy
            ActiveChart.Paste
            ActiveChart.Export (path & "\" & i & "_Map.png")
            ActiveChart.ChartArea.Clear
            shpGroup.Ungroup
        End If
        
        If s.TopLeftCell.Address(ReferenceStyle:=xlR1C1) = defect_pos Then
            With ActiveSheet.ChartObjects.Add(s.Left, s.Top, s.Width, s.Height)
                .Name = "buffer"
                .Activate
            End With
            s.Copy
            ActiveChart.Paste
            ActiveChart.Export (path & "\" & i & "_OM.png")
            ActiveChart.ChartArea.Clear
        End If
        
        Debug.Print "----------"
    
    Next s
Next i

'ActiveChart.ChartArea.Clear

End Sub






